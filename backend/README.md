# üè¶ Backend - Sistema de Gesti√≥n de Clientes Bancarios

[![Django](https://img.shields.io/badge/Django-5.1.3-green.svg)](https://www.djangoproject.com/)
[![DRF](https://img.shields.io/badge/DRF-3.15.2-red.svg)](https://www.django-rest-framework.org/)
[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)

> **EVA3 - Evaluaci√≥n Backend INACAP** | API RESTful completa para gesti√≥n y an√°lisis de clientes bancarios con autenticaci√≥n JWT, estad√≠sticas avanzadas y documentaci√≥n Swagger.

---

## üìñ Descripci√≥n del Proyecto

Sistema de gesti√≥n de clientes bancarios desarrollado como **Evaluaci√≥n 3 del m√≥dulo de Backend** en INACAP. Permite administrar informaci√≥n de clientes, analizar datos bancarios, generar estad√≠sticas de negocio y proporcionar insights sobre la cartera de clientes.

### Contexto de Negocio

El sistema gestiona informaci√≥n cr√≠tica de clientes bancarios incluyendo:
- **Datos demogr√°ficos**: Edad, g√©nero
- **Informaci√≥n financiera**: Saldo de cuenta, estado activo/inactivo
- **M√©tricas de satisfacci√≥n**: Nivel de satisfacci√≥n del cliente (escala 1-5)
- **An√°lisis de datos**: Jupyter notebooks para an√°lisis exploratorio
- **Importaci√≥n masiva**: Carga de datos desde archivos CSV

---

## ‚ú® Caracter√≠sticas Principales

### Core Backend
- ‚úÖ **API REST Completa**: CRUD total con Django REST Framework
- ‚úÖ **Autenticaci√≥n JWT**: Access + Refresh tokens con blacklist
- ‚úÖ **Swagger/OpenAPI**: Documentaci√≥n interactiva autom√°tica (`/api/docs/`)
- ‚úÖ **PostgreSQL**: Base de datos robusta para producci√≥n
- ‚úÖ **SQLite**: Soporte para desarrollo local

### Seguridad & Control
- ‚úÖ **Rate Limiting**: 6 tipos de throttling diferenciado
- ‚úÖ **Custom Permissions**: Control granular de acceso (ownership)
- ‚úÖ **Validaciones Robustas**: M√©todo `clean()` en modelos + serializers
- ‚úÖ **CORS Configurado**: Para integraci√≥n con frontend

### An√°lisis & Estad√≠sticas
- ‚úÖ **Estad√≠sticas Avanzadas**: Top 5, rankings, distribuciones
- ‚úÖ **An√°lisis de Datos**: Jupyter notebooks para exploraci√≥n
- ‚úÖ **M√©tricas de Negocio**: Satisfacci√≥n, rentabilidad, demograf√≠a
- ‚úÖ **Importaci√≥n CSV**: Carga masiva de datos desde archivos

### DevOps & Deployment
- ‚úÖ **Docker**: Containerizaci√≥n completa con Gunicorn
- ‚úÖ **Testing**: 18 tests con pytest + coverage
- ‚úÖ **Scripts**: Setup, monitoreo, verificaci√≥n automatizados
- ‚úÖ **CI/CD Ready**: Configuraci√≥n para producci√≥n

---

## üóÑÔ∏è Modelo de Datos

### Cliente

Representa un cliente bancario con toda su informaci√≥n relevante:

| Campo | Tipo | Descripci√≥n | Validaci√≥n |
|-------|------|-------------|------------|
| `cliente_id` | AutoField | Identificador √∫nico (PK) | Auto-generado |
| `usuario` | ForeignKey | Usuario propietario (Django User) | Opcional, permite multi-usuario |
| `edad` | Integer | Edad del cliente | 18-120 a√±os |
| `genero` | CharField(1) | M (Masculino) / F (Femenino) | Requerido |
| `saldo` | Decimal(100,2) | Saldo de cuenta bancaria | >= 0 |
| `activo` | Boolean | Estado del cliente | Default: True |
| `nivel_de_satisfaccion` | Integer | Satisfacci√≥n del cliente | 1-5 (1=Muy Insatisfecho, 5=Muy Satisfecho) |

**Validaciones Implementadas:**
```python
# En models.py
def clean(self):
    - Edad: 18-120 a√±os
    - Saldo: no negativo
    - Satisfacci√≥n: 1-5

# En serializers.py
validate_edad()
validate_saldo()
validate_nivel_de_satisfaccion()

# En permissions.py
- L√≠mite: 100 clientes por usuario no-admin
- Ownership: Solo propietario o admin puede editar/eliminar
```

---

## üöÄ Instalaci√≥n

### Opci√≥n 1: Desarrollo Local (sin Docker)

```bash
# 1. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 2. Instalar dependencias
pip install -r requirements.txt

# 3. Configurar base de datos
python manage.py migrate

# 4. Crear superusuario
python manage.py createsuperuser

# 5. (Opcional) Importar datos de prueba desde CSV
python manage.py importar_clientes clientes_limpios.csv

# 6. Colectar est√°ticos
python manage.py collectstatic --noinput

# 7. Iniciar servidor
python manage.py runserver
```

### Opci√≥n 2: Con Docker (recomendado)

```bash
# Desde la ra√≠z del proyecto
docker-compose up -d --build

# El backend estar√° disponible en http://localhost:8000
```

---

## üìã API Endpoints

### Autenticaci√≥n

| Endpoint | M√©todo | Descripci√≥n |
|----------|--------|-------------|
| `/api/token/` | POST | Obtener access + refresh token |
| `/api/token/refresh/` | POST | Renovar access token |

**Ejemplo de Login:**
```bash
curl -X POST http://localhost:8000/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'
```

### CRUD de Clientes

| Endpoint | M√©todos | Descripci√≥n | Throttle |
|----------|---------|-------------|----------|
| `/api/v1/clientes/` | GET | Listar clientes | 200/hora |
| `/api/v1/clientes/` | POST | Crear cliente | 50/hora |
| `/api/v1/clientes/{id}/` | GET | Detalle de cliente | 200/hora |
| `/api/v1/clientes/{id}/` | PUT | Actualizar cliente completo | 50/hora |
| `/api/v1/clientes/{id}/` | PATCH | Actualizar parcial | 50/hora |
| `/api/v1/clientes/{id}/` | DELETE | Eliminar cliente | 50/hora |

**Filtros disponibles:**
- `?genero=M` - Filtrar por g√©nero (M/F)
- `?activo=true` - Filtrar por estado activo
- `?nivel_de_satisfaccion=5` - Filtrar por satisfacci√≥n (1-5)
- `?page=2&page_size=50` - Paginaci√≥n

### Estad√≠sticas

| Endpoint | M√©todo | Descripci√≥n | Throttle |
|----------|--------|-------------|----------|
| `/api/v1/clientes/{id}/estadisticas/` | GET | Estad√≠sticas de cliente | 20/hora |
| `/api/v1/clientes/estadisticas-generales/` | GET | Estad√≠sticas del sistema | 20/hora |

**Estad√≠sticas de Cliente Individual:**
```json
{
  "cliente_id": 1,
  "edad": 35,
  "genero": "Masculino",
  "saldo": 15000.50,
  "activo": true,
  "nivel_de_satisfaccion": 4,
  "nivel_satisfaccion_texto": "Satisfecho",
  "ranking_saldo": "Top 25.5%",
  "comparacion_promedio": {
    "edad": {
      "cliente": 35,
      "promedio": 42.3,
      "diferencia": -7.3
    },
    "saldo": {
      "cliente": 15000.50,
      "promedio": 8500.00,
      "diferencia": 6500.50
    }
  }
}
```

**Estad√≠sticas Generales del Sistema:**
```json
{
  "total_clientes": 150,
  "clientes_activos": 135,
  "clientes_inactivos": 15,
  "porcentaje_activos": 90.0,
  "por_genero": {
    "masculino": 75,
    "femenino": 75
  },
  "por_satisfaccion": {
    "muy_insatisfecho": 5,
    "insatisfecho": 15,
    "neutral": 35,
    "satisfecho": 60,
    "muy_satisfecho": 35
  },
  "promedio_edad": 42.5,
  "promedio_saldo": 8500.75,
  "saldo_total": 1275112.50,
  "saldo_maximo": 50000.00,
  "saldo_minimo": 100.00,
  "top_5_clientes_por_saldo": [...],
  "por_rango_edad": {
    "18-30": 30,
    "31-45": 60,
    "46-60": 45,
    "61-80": 15,
    "81+": 0
  },
  "satisfaccion_por_genero": {...},
  "tasa_satisfaccion_general": 63.33,
  "clientes_alta_rentabilidad": 15,
  "porcentaje_alta_rentabilidad": 10.0
}
```

### Documentaci√≥n

| Endpoint | Descripci√≥n |
|----------|-------------|
| `/api/docs/` | Swagger UI interactivo |
| `/api/redoc/` | Documentaci√≥n Redoc |
| `/api/schema/` | Schema OpenAPI (JSON) |
| `/admin/` | Panel de administraci√≥n Django |

---

## üîê Autenticaci√≥n & Permisos

### JWT Authentication

El sistema usa JWT (JSON Web Tokens) con las siguientes caracter√≠sticas:
- **Access Token**: V√°lido por 99 minutos
- **Refresh Token**: V√°lido por 1 d√≠a
- **Token Rotation**: Los refresh tokens se rotan autom√°ticamente
- **Blacklist**: Tokens revocados se almacenan en blacklist

### Permissions Personalizados

```python
# IsOwnerOrAdmin
- Admin: acceso completo
- Usuario: solo sus propios clientes

# IsAdminOrReadOnly
- Admin: puede escribir
- Usuarios: solo lectura

# CanCreateCliente
- L√≠mite: 100 clientes por usuario no-admin
- Admin: sin l√≠mite
```

---

## üõ°Ô∏è Rate Limiting

Protecci√≥n anti-abuso con 6 tipos de throttling:

| Tipo | L√≠mite | Aplica a |
|------|--------|----------|
| **AnonRateThrottle** | 100/hora | Usuarios no autenticados |
| **UserRateThrottle** | 1000/hora | Usuarios autenticados |
| **BurstRateThrottle** | 30/minuto | Todas las peticiones (anti-r√°fagas) |
| **ReadOnlyRateThrottle** | 200/hora | Operaciones GET |
| **WriteRateThrottle** | 50/hora | POST/PUT/PATCH/DELETE |
| **StatsRateThrottle** | 20/hora | Endpoints de estad√≠sticas (costosos) |

---

## üìä An√°lisis de Datos

### Jupyter Notebooks

El proyecto incluye an√°lisis exploratorio de datos:

```bash
# Iniciar Jupyter Notebook
jupyter notebook
```

**Notebooks disponibles:**
- `Untitled.ipynb` - An√°lisis exploratorio de clientes bancarios

### Script de An√°lisis

```bash
# Ejecutar an√°lisis y limpieza de datos
python analisis_datos.py
```

**Procesos incluidos:**
- Limpieza de datos (duplicados, nulos)
- Imputaci√≥n de valores faltantes (mediana, moda)
- Conversi√≥n de tipos de datos
- Generaci√≥n de CSV limpio

### Importaci√≥n de Datos

```bash
# Importar clientes desde CSV
python manage.py importar_clientes clientes_limpios.csv

# Formato esperado del CSV:
# Edad,Genero,Saldo,Activo,Nivel_de_Satisfaccion
# 35,M,5000.50,True,4
```

---

## üß™ Testing

### Ejecutar Tests

```bash
# Todos los tests
pytest

# Con coverage
pytest --cov

# Tests espec√≠ficos
pytest clientes/tests/test_models.py
pytest clientes/tests/test_api.py

# Verbose
pytest -v
```

### Tests Implementados

**Tests Unitarios (test_models.py):**
- ‚úÖ Crear cliente v√°lido
- ‚úÖ Validaci√≥n de edad m√≠nima/m√°xima
- ‚úÖ Validaci√≥n de saldo negativo
- ‚úÖ Validaci√≥n de nivel de satisfacci√≥n
- ‚úÖ Representaci√≥n string
- ‚úÖ Display de g√©nero

**Tests de Integraci√≥n (test_api.py):**
- ‚úÖ Listar clientes (autenticado/no autenticado)
- ‚úÖ Crear cliente
- ‚úÖ Crear cliente con datos inv√°lidos
- ‚úÖ Actualizar cliente
- ‚úÖ Eliminar cliente
- ‚úÖ Estad√≠sticas de cliente
- ‚úÖ Estad√≠sticas generales

**Total: 18 tests**

### Coverage

```bash
# Generar reporte HTML
pytest --cov --cov-report=html

# Ver reporte
open htmlcov/index.html
```

---

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno (.env)

```bash
# Django Core
DEBUG=False
SECRET_KEY=your-super-secret-key-here
ALLOWED_HOSTS=localhost,yourdomain.com

# Database (PostgreSQL)
DATABASE_ENGINE=django.db.backends.postgresql
DATABASE_NAME=banco_db
DATABASE_USER=banco_user
DATABASE_PASSWORD=secure_password_here
DATABASE_HOST=db
DATABASE_PORT=5432

# JWT (minutos)
JWT_ACCESS_TOKEN_LIFETIME=99
JWT_REFRESH_TOKEN_LIFETIME=1440

# Gunicorn
GUNICORN_WORKERS=2
GUNICORN_THREADS=2
GUNICORN_TIMEOUT=120

# Rate Limiting
THROTTLE_ANON_RATE=100/hour
THROTTLE_USER_RATE=1000/hour
```

---

## üîß Comandos √ötiles

### Django Management

```bash
# Migraciones
python manage.py makemigrations
python manage.py migrate

# Crear superusuario
python manage.py createsuperuser

# Colectar est√°ticos
python manage.py collectstatic --noinput

# Shell interactivo
python manage.py shell

# Importar datos
python manage.py importar_clientes <archivo.csv>
```

### Docker

```bash
# Construir y levantar servicios
docker-compose up -d --build

# Ver logs
docker-compose logs -f web

# Ejecutar comando en contenedor
docker-compose exec web python manage.py migrate

# Acceder a shell
docker-compose exec web bash
docker-compose exec web python manage.py shell

# Detener servicios
docker-compose down

# Limpiar todo (incluyendo vol√∫menes)
docker-compose down -v
```

---

## üìÅ Estructura del Proyecto

```
backend/
‚îú‚îÄ‚îÄ banco/                      # Configuraci√≥n Django
‚îÇ   ‚îú‚îÄ‚îÄ settings.py             # Settings (PostgreSQL, JWT, DRF, Swagger)
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                 # URLs principales + Swagger
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py                 # WSGI config para Gunicorn
‚îú‚îÄ‚îÄ clientes/                   # App principal
‚îÇ   ‚îú‚îÄ‚îÄ models.py               # Modelo Cliente con validaciones
‚îÇ   ‚îú‚îÄ‚îÄ views.py                # ViewSet + endpoints estad√≠sticas
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py          # Serializers con validaciones
‚îÇ   ‚îú‚îÄ‚îÄ permissions.py          # Permissions personalizados
‚îÇ   ‚îú‚îÄ‚îÄ throttling.py           # Throttling personalizado
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                 # Router DRF
‚îÇ   ‚îú‚îÄ‚îÄ admin.py                # Admin Django
‚îÇ   ‚îú‚îÄ‚îÄ filters.py              # Filtros personalizados
‚îÇ   ‚îú‚îÄ‚îÄ management/             # Comandos personalizados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ importar_clientes.py
‚îÇ   ‚îî‚îÄ‚îÄ tests/                  # Tests
‚îÇ       ‚îú‚îÄ‚îÄ test_models.py      # Tests unitarios
‚îÇ       ‚îî‚îÄ‚îÄ test_api.py         # Tests de integraci√≥n
‚îú‚îÄ‚îÄ clientes_templates/         # Vistas HTML Django (opcional)
‚îú‚îÄ‚îÄ static/                     # Archivos est√°ticos
‚îú‚îÄ‚îÄ Dockerfile                  # Multi-stage build
‚îú‚îÄ‚îÄ docker-entrypoint.sh        # Script de inicio
‚îú‚îÄ‚îÄ gunicorn.conf.py            # Configuraci√≥n Gunicorn
‚îú‚îÄ‚îÄ pytest.ini                  # Configuraci√≥n pytest
‚îú‚îÄ‚îÄ requirements.txt            # Dependencias Python
‚îú‚îÄ‚îÄ manage.py                   # Django CLI
‚îú‚îÄ‚îÄ analisis_datos.py           # Script an√°lisis de datos
‚îú‚îÄ‚îÄ clientes_banco.csv          # Datos originales
‚îú‚îÄ‚îÄ clientes_limpios.csv        # Datos procesados
‚îî‚îÄ‚îÄ Untitled.ipynb              # Jupyter notebook an√°lisis
```

---

## üõ†Ô∏è Stack Tecnol√≥gico

| Categor√≠a | Tecnolog√≠a | Versi√≥n |
|-----------|------------|---------|
| **Framework** | Django | 5.1.3 |
| **API** | Django REST Framework | 3.15.2 |
| **Auth** | djangorestframework-simplejwt | 5.3.1 |
| **Docs** | drf-spectacular | 0.27.2 |
| **Database** | PostgreSQL | 16 (prod) |
| | SQLite | 3 (dev) |
| **Server** | Gunicorn | 23.0.0 |
| **Container** | Docker | Latest |
| **Testing** | pytest | 8.3.3 |
| | pytest-django | 4.9.0 |
| | pytest-cov | 6.0.0 |
| **Analysis** | pandas | 2.2.2 |
| | jupyter | 1.0.0 |
| **Code Quality** | black | 24.10.0 |
| | flake8 | 7.1.1 |

---

## üìö Documentaci√≥n Adicional

- **[README Principal](../README.md)** - Documentaci√≥n completa del proyecto
- **[Conexi√≥n Frontend-Backend](../README_CONEXION.md)** - Gu√≠a de integraci√≥n
- **[Funcionalidades CRUD](../FUNCIONALIDADES_CRUD.md)** - Detalle de operaciones
- **[Comparaci√≥n Evaluaciones](../COMPARACION_EVALUACIONES.md)** - EVA1 vs EVA2 vs EVA3

---

## ü§ù Contribuir

Este es un proyecto acad√©mico de evaluaci√≥n. No se aceptan contribuciones externas.

---

## üìÑ Licencia

Proyecto acad√©mico - INACAP 2024/2025

---

## üë®‚Äçüíª Autor

**Sebasti√°n Bravo**
- GitHub: [@sebitabravo](https://github.com/sebitabravo)
- Evaluaci√≥n 3 - Backend INACAP

---

## üéì Contexto Acad√©mico

**Asignatura**: Backend / Desarrollo de Aplicaciones Web
**Instituci√≥n**: INACAP
**Evaluaci√≥n**: EVA3 - Evaluaci√≥n Final
**A√±o**: 2024-2025

---

**üè¶ Sistema de Gesti√≥n de Clientes Bancarios - Backend API**