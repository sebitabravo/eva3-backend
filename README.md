# üè¶ EVA3 - Sistema de Gesti√≥n de Clientes Bancarios

[![Django](https://img.shields.io/badge/Django-5.1.3-green.svg)](https://www.djangoproject.com/)
[![DRF](https://img.shields.io/badge/DRF-3.15.2-red.svg)](https://www.django-rest-framework.org/)
[![React](https://img.shields.io/badge/React-18.3.1-blue.svg)](https://reactjs.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)](https://www.docker.com/)

> **Sistema Full-Stack de Gesti√≥n Bancaria** | API REST profesional con Django + Frontend React moderno

Sistema completo de gesti√≥n y an√°lisis de clientes bancarios con autenticaci√≥n JWT, dashboard interactivo, estad√≠sticas avanzadas, seguridad multicapa y despliegue Docker listo para producci√≥n.

---

## ‚ú® Caracter√≠sticas Principales

### üéØ Backend (Django REST Framework)
- ‚úÖ **API REST Completa**: CRUD total con ViewSets y filtros avanzados
- ‚úÖ **Autenticaci√≥n JWT**: Access + Refresh tokens con blacklist
- ‚úÖ **Swagger/OpenAPI**: Documentaci√≥n interactiva autom√°tica en `/api/docs/`
- ‚úÖ **Rate Limiting**: 10,000 req/hora usuarios autenticados, 30 req/hora an√≥nimos
- ‚úÖ **Estad√≠sticas Avanzadas**: M√©tricas de negocio y an√°lisis de datos
- ‚úÖ **Validaciones Robustas**: M√©todo clean() en modelos + serializers
- ‚úÖ **PostgreSQL + SQLite**: Multi-database support
- ‚úÖ **Gunicorn**: Servidor WSGI optimizado para producci√≥n
- ‚úÖ **Testing**: 18 tests con pytest + coverage

### üé® Frontend (React + shadcn/ui)
- ‚úÖ **4 Vistas Avanzadas**: Dashboard, Clientes, An√°lisis, Salud del Cliente
- ‚úÖ **5 Gr√°ficos Interactivos**: Recharts con visualizaciones profesionales
- ‚úÖ **Sistema de Cach√©**: 90% menos API calls con localStorage persistente
- ‚úÖ **shadcn/ui Components**: UI moderna y accesible
- ‚úÖ **Modo Demo**: Banner y protecci√≥n visual para portafolios
- ‚úÖ **Filtros Interactivos**: Edad, g√©nero, estado con actualizaci√≥n en tiempo real
- ‚úÖ **Alertas Visuales**: Identificaci√≥n de clientes en riesgo
- ‚úÖ **Responsive Design**: Mobile-first con Tailwind CSS

### üîí Seguridad & Protecci√≥n
- ‚úÖ **Modo Demo**: Middleware de protecci√≥n para despliegues p√∫blicos
- ‚úÖ **4 Capas de Seguridad**: Middleware, Permisos, Rate Limiting, Variables de entorno
- ‚úÖ **Usuario Demo**: Permisos de solo lectura (demo/demo2024)
- ‚úÖ **CORS Configurado**: Or√≠genes permitidos espec√≠ficos
- ‚úÖ **Validaciones**: Frontend y backend con mensajes descriptivos

### üöÄ DevOps & Deployment
- ‚úÖ **Docker Compose**: Orquestaci√≥n multi-container
- ‚úÖ **Dockerfile Multi-Stage**: Build optimizado para producci√≥n
- ‚úÖ **Dokploy Compatible**: Variables de entorno unificadas
- ‚úÖ **Scripts Automatizados**: Setup, monitoreo, verificaci√≥n
- ‚úÖ **Healthchecks**: Monitoreo de servicios
- ‚úÖ **L√≠mites de Recursos**: 512MB RAM por contenedor

---

## üöÄ Quick Start

### Opci√≥n 1: Setup Autom√°tico (Recomendado)

```bash
git clone https://github.com/sebitabravo/eva3-backend.git
cd eva3-backend
./setup.sh
```

### Opci√≥n 2: Docker Compose

```bash
# 1. Clonar y configurar
git clone https://github.com/sebitabravo/eva3-backend.git
cd eva3-backend
cp backend/.env.example .env

# 2. Levantar servicios
docker-compose up -d --build

# 3. Crear usuario admin
docker-compose exec web python manage.py createsuperuser

# 4. (Opcional) Crear usuario demo
docker-compose exec web python manage.py create_demo_user
```

**Acceder:**
- Frontend: http://localhost:5173 (Usuario: admin/admin o demo/demo2024)
- Backend API: http://localhost:8000/api/v1/clientes/
- Swagger Docs: http://localhost:8000/api/docs/
- Admin Panel: http://localhost:8000/admin/

### Opci√≥n 3: Desarrollo Local (Sin Docker)

```bash
# Backend
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver

# Frontend (nueva terminal)
cd frontend
npm install
npm run dev
```

---

## üìä Dashboard y Vistas

### 1. Dashboard General
- **M√©tricas clave**: Total clientes, saldo promedio, edad promedio, cliente top
- **Gr√°ficos**: Distribuci√≥n por edad, satisfacci√≥n y g√©nero

### 2. Gesti√≥n de Clientes (CRUD)
- **CRUD Completo**: Crear, leer, actualizar, eliminar con modal forms
- **Alertas visuales**: Icono ‚ö†Ô∏è para clientes en riesgo
- **Filtros**: Por g√©nero, estado, nivel de satisfacci√≥n

### 3. An√°lisis por Segmentos
- **Filtros interactivos**: Rango de edad (slider), g√©nero, estado
- **Gr√°ficos avanzados**:
  - Satisfacci√≥n vs Saldo promedio (barras dobles)
  - Edad vs Saldo (scatter plot coloreado)
- **Leyenda sem√°ntica**: Colores por nivel de satisfacci√≥n

### 4. Salud del Cliente
- **M√©tricas de riesgo**: Total en riesgo, riesgo alto/medio, valor en riesgo
- **Tabla de clientes en riesgo**: Satisfacci√≥n ‚â§ 2
- **Recomendaciones**: 3 pasos para retenci√≥n de clientes
- **Acciones r√°pidas**: Botones Contactar/Llamar

---

## üîë Autenticaci√≥n y Seguridad

### Modo Demo para Portafolio

**Configuraci√≥n:**
```bash
# Backend (.env)
DEMO_MODE=True
DEBUG=False

# Frontend (.env)
VITE_DEMO_MODE=true
VITE_API_URL=https://tu-dominio.com/api/v1
```

**Caracter√≠sticas del Modo Demo:**
- üîí Middleware bloquea POST/PUT/PATCH/DELETE
- üìñ Solo operaciones de lectura (GET)
- üëÅÔ∏è Banner amarillo visible "Modo Demostraci√≥n Activo"
- üîó Link a GitHub para ver c√≥digo completo
- ‚ö° Usuario demo sin permisos de escritura

**Crear usuario demo:**
```bash
python manage.py create_demo_user
# Usuario: demo | Password: demo2024
```

### JWT Authentication

```bash
# Obtener token
curl -X POST http://localhost:8000/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'

# Usar token
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:8000/api/v1/clientes/
```

**Configuraci√≥n JWT:**
- Access Token: 99 minutos
- Refresh Token: 1 d√≠a
- Token Blacklist: Habilitado

---

## üìã API Endpoints

### Autenticaci√≥n
| Endpoint | M√©todo | Descripci√≥n |
|----------|--------|-------------|
| `/api/token/` | POST | Obtener access + refresh token |
| `/api/token/refresh/` | POST | Renovar access token |

### CRUD de Clientes
| Endpoint | M√©todos | Descripci√≥n |
|----------|---------|-------------|
| `/api/v1/clientes/` | GET, POST | Listar y crear clientes |
| `/api/v1/clientes/{id}/` | GET, PUT, PATCH, DELETE | Detalle, actualizar, eliminar |
| `/api/v1/clientes/estadisticas-generales/` | GET | Estad√≠sticas del sistema |
| `/api/v1/clientes/{id}/estadisticas/` | GET | Estad√≠sticas por cliente |

**Filtros disponibles:**
- `?genero=M` - Filtrar por g√©nero (M/F)
- `?activo=true` - Filtrar por estado
- `?nivel_de_satisfaccion=5` - Filtrar por satisfacci√≥n (1-5)

### Documentaci√≥n
| Endpoint | Descripci√≥n |
|----------|-------------|
| `/api/docs/` | Swagger UI interactivo |
| `/api/redoc/` | Documentaci√≥n Redoc |
| `/api/schema/` | Schema OpenAPI (JSON) |
| `/admin/` | Panel de administraci√≥n Django |

---

## üéØ Rate Limiting

| Tipo | L√≠mite | Descripci√≥n |
|------|--------|-------------|
| **Usuarios autenticados** | 10,000/hora | Acceso completo a la API |
| **Usuarios an√≥nimos** | 30/hora | Lectura limitada |
| **Burst** | 100/min | Prevenci√≥n de r√°fagas |
| **Write operations** | 1,000/hora | POST/PUT/PATCH/DELETE |
| **Stats endpoints** | 500/hora | Endpoints de estad√≠sticas |

**Optimizaci√≥n Frontend:**
- Sistema de cach√© de 15 minutos
- Persistencia en localStorage
- 90% reducci√≥n de API calls
- Navegaci√≥n instant√°nea entre vistas

---

## üê≥ Docker & Deployment

### Servicios Docker

| Servicio | Puerto | Descripci√≥n |
|----------|--------|-------------|
| **web** | 8000 | Django + Gunicorn |
| **db** | 5432 | PostgreSQL 16 |
| **frontend** | 80 (prod) / 5173 (dev) | React + Vite / Nginx |

### Comandos Docker √ötiles

```bash
# Ver logs
docker-compose logs -f
docker-compose logs -f web

# Ejecutar comandos en contenedor
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py create_demo_user

# Shell de Django/PostgreSQL
docker-compose exec web python manage.py shell
docker-compose exec db psql -U banco_user -d banco_db

# Gesti√≥n de contenedores
docker-compose restart
docker-compose down
docker-compose down -v  # Eliminar vol√∫menes
docker-compose build --no-cache
```

### Despliegue en Dokploy

**Variables de entorno cr√≠ticas:**
```bash
# Django
DJANGO_SECRET_KEY=generar-uno-nuevo-aqui
DEBUG=False
ALLOWED_HOSTS=tu-dominio.com
DEMO_MODE=True

# Base de datos (nombres simplificados)
DB_ENGINE=postgresql
DB_NAME=banco_db
DB_USER=banco_user
DB_PASSWORD=password-seguro
DB_HOST=db
DB_PORT=5432

# Frontend
NODE_ENV=production
VITE_API_URL=https://tu-dominio.com/api/v1
VITE_DEMO_MODE=true

# Superuser
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=password-admin-seguro
```

**Pasos para Dokploy:**
1. Conectar repositorio GitHub
2. Configurar variables de entorno
3. Dokploy detecta autom√°ticamente `docker-compose.yml`
4. Deploy ‚Üí SSL autom√°tico con Let's Encrypt

---

## üìà Monitoreo

### Script de Monitoreo

```bash
# Estado actual
./monitor-resources.sh status

# Monitoreo continuo (actualiza cada 5s)
./monitor-resources.sh watch

# Ver logs recientes
./monitor-resources.sh logs

# Ver todo
./monitor-resources.sh all
```

**M√©tricas monitoreadas:**
- CPU y memoria por contenedor
- I/O de red y disco
- Healthchecks de servicios
- Vol√∫menes Docker
- Alertas autom√°ticas (>80% uso)

---

## üõ†Ô∏è Stack Tecnol√≥gico

### Backend
- **Framework**: Django 5.1.3
- **API**: Django REST Framework 3.15.2
- **Auth**: djangorestframework-simplejwt 5.3.1
- **Docs**: drf-spectacular 0.27.2
- **Database**: PostgreSQL 16 (prod), SQLite (dev)
- **Server**: Gunicorn 23.0.0
- **Testing**: pytest 8.3.3, pytest-django 4.9.0

### Frontend
- **Framework**: React 18.3.1
- **Build**: Vite 5.4.20
- **UI**: shadcn/ui + Tailwind CSS 3.4.0
- **Charts**: Recharts 2.x
- **HTTP**: Axios 1.12.2
- **Icons**: Lucide React

### Infrastructure
- **Containerization**: Docker + Docker Compose
- **Database**: PostgreSQL 16 Alpine
- **Web Server**: Gunicorn + Nginx (prod)
- **Process Manager**: Docker

---

## üì¶ Estructura del Proyecto

```
eva3-backend/
‚îú‚îÄ‚îÄ backend/                    # Django REST API
‚îÇ   ‚îú‚îÄ‚îÄ banco/                  # Configuraci√≥n Django
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py         # PostgreSQL, JWT, DRF, Swagger, Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py       # DemoModeMiddleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py             # URLs + Swagger endpoints
‚îÇ   ‚îú‚îÄ‚îÄ clientes/               # App principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py           # Modelo Cliente con validaciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py            # ViewSet + estad√≠sticas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py      # Validaciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permissions.py      # Permisos personalizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ throttling.py       # Rate limiting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ management/commands/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_demo_user.py  # Usuario demo
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ importar_clientes.py # Importar CSV
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tests/              # 18 tests (pytest)
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage build
‚îÇ   ‚îú‚îÄ‚îÄ docker-entrypoint.sh    # Script de inicio
‚îÇ   ‚îú‚îÄ‚îÄ gunicorn.conf.py        # Gunicorn config
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt        # Dependencias
‚îú‚îÄ‚îÄ frontend/                   # React SPA
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx           # Vista 1: Dashboard general
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClienteList.jsx         # Vista 2: CRUD clientes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnalysisSegments.jsx    # Vista 3: An√°lisis filtrado
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientHealth.jsx        # Vista 4: Salud del cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                     # shadcn/ui components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Custom hooks (use-toast)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                # Utilidades
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.jsx             # Navegaci√≥n + cach√© + auth
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage con Nginx
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf              # Nginx para producci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ package.json            # Dependencias Node
‚îú‚îÄ‚îÄ docker-compose.yml          # Orquestaci√≥n (dev + prod)
‚îú‚îÄ‚îÄ .env.production             # Template variables producci√≥n
‚îú‚îÄ‚îÄ setup.sh                    # Setup automatizado
‚îú‚îÄ‚îÄ monitor-resources.sh        # Monitoreo Docker
‚îî‚îÄ‚îÄ README.md                   # Este archivo
```

---

## üß™ Testing

```bash
# Ejecutar todos los tests
cd backend
pytest

# Con coverage
pytest --cov

# Ver reporte HTML
pytest --cov --cov-report=html
open htmlcov/index.html
```

**18 tests implementados:**
- Tests unitarios (models.py)
- Tests de integraci√≥n (API endpoints)
- Coverage: modelos, serializers, views

---

## üìö Documentaci√≥n por M√≥dulo

- **[Backend Documentation](backend/README.md)** - API REST completa, testing, an√°lisis de datos
- **[Frontend Documentation](frontend/README.md)** - Dashboard, componentes, sistema de cach√©

---

## üèÜ Comparaci√≥n con Evaluaciones Anteriores

| Caracter√≠stica | EVA1 | EVA2 | EVA3 |
|----------------|------|------|------|
| Frontend React completo | ‚ùå | ‚ùå | ‚úÖ 4 vistas + shadcn/ui |
| Dashboard interactivo | ‚ùå | ‚ùå | ‚úÖ 5 gr√°ficos |
| Sistema de cach√© | ‚ùå | ‚ùå | ‚úÖ 90% menos API calls |
| Modo demo seguro | ‚ùå | ‚ùå | ‚úÖ Middleware + permisos |
| JWT Authentication | ‚ùå | ‚úÖ | ‚úÖ Con blacklist |
| Swagger/OpenAPI | ‚ùå | ‚úÖ | ‚úÖ drf-spectacular |
| Docker + PostgreSQL | ‚úÖ | ‚úÖ | ‚úÖ Multi-container |
| Rate Limiting | ‚úÖ B√°sico | ‚úÖ Avanzado | ‚úÖ Optimizado (10k/h) |
| Testing | ‚ùå | ‚ö†Ô∏è Parcial | ‚úÖ 18 tests + coverage |
| Despliegue Dokploy | ‚ùå | ‚ùå | ‚úÖ Variables unificadas |

**Ventaja competitiva de EVA3:**
- Frontend moderno profesional que EVA1 y EVA2 no tienen
- Sistema de seguridad multicapa ideal para portafolios p√∫blicos
- Optimizaci√≥n de performance con sistema de cach√© inteligente

---

## ü§ù Contribuir

Este es un proyecto acad√©mico de evaluaci√≥n. No se aceptan contribuciones externas.

---

## üìÑ Licencia

Proyecto acad√©mico - INACAP 2024/2025

---

## üë®‚Äçüíª Autor

**Sebasti√°n Bravo**
- GitHub: [@sebitabravo](https://github.com/sebitabravo)
- Evaluaci√≥n 3 - Backend INACAP

---

## üéØ Para Reclutadores

**Destacados del proyecto:**
- ‚úÖ Full-stack completo (Django REST + React)
- ‚úÖ 4 vistas avanzadas con visualizaciones profesionales
- ‚úÖ Sistema de seguridad multicapa para despliegues p√∫blicos
- ‚úÖ Optimizaci√≥n de performance (90% reducci√≥n de API calls)
- ‚úÖ Testing comprehensivo con pytest
- ‚úÖ Docker + CI/CD ready
- ‚úÖ Documentaci√≥n profesional completa

**Demo en vivo:** [Tu URL de Dokploy aqu√≠]
- Usuario: demo
- Contrase√±a: demo2024
- Modo solo lectura activado

---

**üéì Proyecto desarrollado como Evaluaci√≥n 3 del m√≥dulo de Backend - INACAP 2024/2025**
